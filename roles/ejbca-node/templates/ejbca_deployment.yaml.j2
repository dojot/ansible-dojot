apiVersion: apps/v1
kind: Deployment

metadata:
  name: ejbca-wrapper
  namespace: {{ dojot_namespace }}
spec:
  selector:
    matchLabels:
      app: ejbca-wrapper
  replicas: 1
  template:
    metadata:
      labels:
        app: ejbca-wrapper
    spec:
      hostname: localhost
      containers:
      - name: ejbca-wrapper
        image: dojot/ejbca-wrapper:{{ dojot_ejbca_version  }}
        env:
        - name: DATABASE_JDBC_URL
          value: "{{ dojot_psql_ejbca_db_url }}"
        - name: DATABASE_USER
          valueFrom:
            secretKeyRef:
              name: ejbca-secret
              key: user
        - name: DATABASE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: ejbca-secret
              key: password  
        - name: LOG_LEVEL_APP
          value: "ERROR"
        - name: LOG_LEVEL_SERVER_SUBSYSTEMS
          value: "ERROR"
        - name: LOG_LEVEL_APP_WS_TRANSACTIONS
          value: "ERROR"
        - name: LOG_LEVEL_SERVER
          value: "ERROR"
        - name: LOG_LEVEL_APP_OCSP_TRANSACTIONS
          value: "ERROR"
